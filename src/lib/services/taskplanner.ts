import apiClient, { API_URL } from "../api/farmoperation";

const BASE_URL = `${API_URL}/api/task-planner`;

export interface Task {
Â  id: string; // Required
Â  title: string;
Â  status?: string;
Â  priority?: string;
Â  timeline?: {
Â  Â  dueDate?: string;
Â  Â  dueTime?: string;
Â  };
Â  createdTime?: string;
Â  note?: string;
Â  attachment?: unknown;
Â  taskType: string;
Â  assignee: string;
Â  entity_id: string;
}

// 1. TaskCreationPayload: Used for POST /api/task-planner
// It omits properties generated by the server (id, createdTime).
export type TaskCreationPayload = Omit<Task, 'id' | 'createdTime'>;

// 2. TaskUpdatePayload: Used for PUT /api/task-planner/{id}
// It should contain the 'id' if the API requires it in the body, but since your
// 'updateTask' function takes 'TaskCreationData' (which includes 'id'), we'll rename 
// your original type for clarity, though TaskUpdatePayload is usually Partial<Task>.
export type TaskUpdatePayload = TaskCreationPayload & { id: string };

// --- API Functions ---

// Fetches all tasks from the API using apiClient.
export const getTasks = async (id: string): Promise<Task[]> => {
Â  const response = await apiClient.get(`${BASE_URL}/assignee/${id}`);
Â  return response.data;
};

// Creates a new task using apiClient.
// FIX: Use the new TaskCreationPayload which correctly omits 'id'.
export const createTask = async (taskData: TaskCreationPayload): Promise<Task> => {
Â  const response = await apiClient.post(BASE_URL, taskData);
Â  return response.data;
};

// Updates an existing task by its ID using apiClient.
// The payload here should contain the fields to update.
// We use Partial<TaskCreationPayload> to allow sending only the changed fields,
// which is standard for PUT/PATCH updates.
export const updateTask = async (id: string, taskData: Partial<TaskCreationPayload>): Promise<Task> => {
Â  const response = await apiClient.put(`${BASE_URL}/${id}`, taskData);
Â  return response.data;
};

// Deletes a task by its ID using apiClient.
export const deleteTask = async (id: string): Promise<{ message: string }> => {
Â  const response = await apiClient.delete(`${BASE_URL}/${id}`);
Â  return response.data;
};


// src/lib/services/taskplanner.ts (or similar)
// ... existing imports

// Define the structure for a notification item
export interface Notification {
    id: string;
    message: string;
    taskId: string;
    read: boolean;
    timestamp: string;
}

// Function to fetch notifications for a specific user
export const getNotifications = async (userId: string): Promise<Notification[]> => {
    // ðŸ’¡ Assuming API_URL is correctly defined and imported
    const response = await apiClient.get(`${API_URL}/api/task-planner/notification/${userId}`);
    return response.data;
};

// ... other task-related functions